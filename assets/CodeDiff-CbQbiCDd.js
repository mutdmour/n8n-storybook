import{d as ie,f as le,o as h,a as S,b as k,z as $,y as b,F as se,E as ue,p as O,u as L,n as V,D as B,j as ce,H as q}from"./vue.esm-bundler-CKZLKMJN.js";import{g as de}from"./_commonjsHelpers-BosuxZz1.js";import{u as fe}from"./useI18n-BYVGpRei.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";function T(n){"@babel/helpers - typeof";return T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(n)}function me(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=W(n))||e){t&&(n=t);var r=0,u=function(){};return{s:u,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(d){throw d},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y=!0,i=!1,l;return{s:function(){t=t.call(n)},n:function(){var d=t.next();return y=d.done,d},e:function(d){i=!0,l=d},f:function(){try{!y&&t.return!=null&&t.return()}finally{if(i)throw l}}}}function F(n,e,t){return e=ye(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ye(n){var e=ve(n,"string");return T(e)==="symbol"?e:String(e)}function ve(n,e){if(T(n)!=="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(T(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function z(n,e){return be(n)||he(n,e)||W(n,e)||ge()}function ge(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function W(n,e){if(n){if(typeof n=="string")return P(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return P(n,e)}}function P(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function he(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,u,y,i,l=[],c=!0,d=!1;try{if(y=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=y.call(t)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(s){d=!0,u=s}finally{try{if(!c&&t.return!=null&&(i=t.return(),Object(i)!==i))return}finally{if(d)throw u}}return l}}function be(n){if(Array.isArray(n))return n}var _e=function(n){if(!n)return[];if(typeof n!="string"||n.match(/^\s+$/))return[];var e=n.split(`
`);if(e.length===0)return[];var t=[],r=null,u=null,y=0,i=0,l=null,c=function(a){var o;(o=u)===null||o===void 0||o.changes.push({type:"normal",normal:!0,ln1:y++,ln2:i++,content:a}),l.oldLines--,l.newLines--},d=function(a){var o,v=(o=Se(a))!==null&&o!==void 0?o:[],p=z(v,2),m=p[0],_=p[1];r={chunks:[],deletions:0,additions:0,from:m,to:_},t.push(r)},s=function(){(!r||r.chunks.length)&&d()},N=function(a,o){s(),r.new=!0,r.newMode=o[1],r.from="/dev/null"},I=function(a,o){s(),r.deleted=!0,r.oldMode=o[1],r.to="/dev/null"},D=function(a,o){s(),r.oldMode=o[1]},C=function(a,o){s(),r.newMode=o[1]},g=function(a,o){s(),r.index=a.split(" ").slice(1),o[1]&&(r.oldMode=r.newMode=o[1].trim())},G=function(a){s(),r.from=j(a)},J=function(a){s(),r.to=j(a)},M=function(a){return+(a||1)},Q=function(a,o){r||d(a);var v=o.slice(1),p=z(v,4),m=p[0],_=p[1],w=p[2],R=p[3];y=+m,i=+w,u={content:a,changes:[],oldStart:+m,oldLines:M(_),newStart:+w,newLines:M(R)},l={oldLines:M(_),newLines:M(R)},r.chunks.push(u)},X=function(a){u&&(u.changes.push({type:"del",del:!0,ln:y++,content:a}),r.deletions++,l.oldLines--)},Y=function(a){u&&(u.changes.push({type:"add",add:!0,ln:i++,content:a}),r.additions++,l.newLines--)},x=function(a){var o;if(u){var v=u.changes.slice(-1),p=z(v,1),m=p[0];u.changes.push((o={type:m.type},F(o,m.type,!0),F(o,"ln1",m.ln1),F(o,"ln2",m.ln2),F(o,"ln",m.ln),F(o,"content",a),o))}},ee=[[/^diff\s/,d],[/^new file mode (\d+)$/,N],[/^deleted file mode (\d+)$/,I],[/^old mode (\d+)$/,D],[/^new mode (\d+)$/,C],[/^index\s[\da-zA-Z]+\.\.[\da-zA-Z]+(\s(\d+))?$/,g],[/^---\s/,G],[/^\+\+\+\s/,J],[/^@@\s+-(\d+),?(\d+)?\s+\+(\d+),?(\d+)?\s@@/,Q],[/^\\ No newline at end of file$/,x]],ne=[[/^\\ No newline at end of file$/,x],[/^-/,X],[/^\+/,Y],[/^\s+/,c]],te=function(a){for(var o=0,v=ne;o<v.length;o++){var p=z(v[o],2),m=p[0],_=p[1],w=a.match(m);if(w){_(a,w);break}}l.oldLines===0&&l.newLines===0&&(l=null)},re=function(a){for(var o=0,v=ee;o<v.length;o++){var p=z(v[o],2),m=p[0],_=p[1],w=a.match(m);if(w){_(a,w);break}}},oe=function(a){l?te(a):re(a)},A=me(e),E;try{for(A.s();!(E=A.n()).done;){var ae=E.value;oe(ae)}}catch(f){A.e(f)}finally{A.f()}return t},we=/(a|i|w|c|o|1|2)\/.*(?=["']? ["']?(b|i|w|c|o|1|2)\/)|(b|i|w|c|o|1|2)\/.*$/g,Z=/^(a|b|i|w|c|o|1|2)\//,Se=function(e){var t=e==null?void 0:e.match(we);return t==null?void 0:t.map(function(r){return r.replace(Z,"").replace(/("|')$/,"")})},ke=/^\\?['"]|\\?['"]$/g,j=function(e){var t=$e(e,"-+").trim();return t=Ne(t),t.replace(ke,"").replace(Z,"")},$e=function(e,t){e=K(e);var r=Le(t);return e.replace(new RegExp("^".concat(r,"+")),"")},Ce=/\t.*|\d{4}-\d\d-\d\d\s\d\d:\d\d:\d\d(.\d+)?\s(\+|-)\d\d\d\d/,Ne=function(e){var t=Ce.exec(e);return t&&(e=e.substring(0,t.index).trim()),e},Le=function(e){return e instanceof RegExp?e.source:"[".concat(K(e).replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"]")},K=function(e){return(e??"")+""};const Fe=de(_e),ze={key:0},Te={key:1},De={key:2},Me={key:0},Ae={key:1},H=4,U=ie({__name:"CodeDiff",props:{title:{default:""},content:{default:""},replacing:{type:Boolean,default:!1},replaced:{type:Boolean,default:!1},error:{type:Boolean,default:!1},streaming:{type:Boolean,default:!1}},emits:["replace","undo"],setup(n,{emit:e}){const t=n,r=e,{t:u}=fe(),y=le(()=>{const l=Fe(t.content)[0]??{chunks:[]},c=l.chunks.reduce((s,N,I)=>{const D=N.changes.map(C=>{let g=C.content;return C.type==="add"&&g.startsWith("+")?g=g.replace("+",""):C.type==="del"&&g.startsWith("-")&&(g=g.replace("-","")),{...C,content:g}});return I!==l.chunks.length-1&&D.push({type:"seperator",content:"..."}),[...s,...D]},[]),d=c.length;if(d<=H)for(let s=0;s<H-d;s++)c.push({type:"filler",content:""});return c});return(i,l)=>{const c=q("n8n-icon"),d=q("n8n-button");return h(),S("div",{class:b(i.$style.container),"data-test-id":"code-diff-suggestion"},[k("div",{class:b(i.$style.title)},$(i.title),3),k("div",{class:b(i.$style.diffSection)},[(h(!0),S(se,null,ue(y.value,(s,N)=>(h(),S("div",{key:N,class:b(i.$style.diff)},[k("div",{class:b(i.$style.lineNumber)},$(s.type==="normal"?s.ln2:s.type==="add"?s.ln:""),3),k("div",{class:b([i.$style[s.type],i.$style.diffContent])},[s.type==="add"?(h(),S("span",ze," + ")):s.type==="del"?(h(),S("span",Te," - ")):(h(),S("span",De,"   ")),k("span",null,$(s.content),1)],2)],2))),128))],2),k("div",{class:b(i.$style.actions)},[i.error?(h(),S("div",Me,[O(c,{icon:"exclamation-triangle",color:"danger",class:"mr-5xs"}),k("span",{class:b(i.$style.infoText)},$(L(u)("codeDiff.couldNotReplace")),3)])):i.replaced?(h(),S("div",Ae,[O(d,{type:"secondary",size:"mini",icon:"undo","data-test-id":"undo-replace-button",onClick:l[0]||(l[0]=()=>r("undo"))},{default:V(()=>[B($(L(u)("codeDiff.undo")),1)]),_:1}),O(c,{icon:"check",color:"success",class:"ml-xs"}),k("span",{class:b(i.$style.infoText),"data-test-id":"code-replaced-message"},$(L(u)("codeDiff.codeReplaced")),3)])):(h(),ce(d,{key:2,type:i.replacing?"secondary":"primary",size:"mini",icon:"refresh","data-test-id":"replace-code-button",disabled:!i.content||i.streaming,loading:i.replacing,onClick:l[1]||(l[1]=()=>r("replace"))},{default:V(()=>[B($(i.replacing?L(u)("codeDiff.replacing"):L(u)("codeDiff.replaceMyCode")),1)]),_:1},8,["type","disabled","loading"]))],2)],2)}}}),Ie="_container_yn1cz_1",Oe="_title_yn1cz_7",xe="_lineNumber_yn1cz_16",Ee="_diffSection_yn1cz_24",Re="_diff_yn1cz_24",Ve="_diffContent_yn1cz_41",Be="_add_yn1cz_50",qe="_del_yn1cz_55",Pe="_normal_yn1cz_60",je="_actions_yn1cz_64",He="_infoText_yn1cz_68",We={container:Ie,title:Oe,lineNumber:xe,diffSection:Ee,diff:Re,diffContent:Ve,add:Be,del:qe,normal:Pe,actions:je,infoText:He},Ze={$style:We},Qe=pe(U,[["__cssModules",Ze]]);U.__docgenInfo={exportName:"default",displayName:"CodeDiff",description:"",tags:{},props:[{name:"title",required:!0,type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"content",required:!0,type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"replacing",required:!0,type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"replaced",required:!0,type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"error",required:!0,type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"streaming",required:!0,type:{name:"boolean"},defaultValue:{func:!1,value:"false"}}],events:[{name:"replace"},{name:"undo"}],sourceFiles:["/home/runner/work/n8n-storybook/n8n-storybook/packages/design-system/src/components/CodeDiff/CodeDiff.vue"]};export{Qe as C};
